services: docker
language: python

python:
  - "3.6"      # current default Python on Travis CI
  - "3.7"
  - "3.8"
  - "3.8-dev"  # 3.8 development branch
  - "nightly"  # nightly build

branches:
  only:
    - master
    - dev

before_install:
- echo -e "machine github.com\n  login $CI_USER_TOKEN" > ~/.netrc

# command to install dependencies
install:
  - pip install -r requirements.txt

jobs:
  include:
    # run unit tests
    - stage: unit-tests
      script: pytest

    # build container
    - stage: build
      script: ./travis-build.sh

    # run integration tests
    - stage: integration-tests
      script: docker run --rm opentransport/gtfs-exporter:dev  gtfs-process --provider=url --url=https://tursib.ro/trasee/gtfs --id=test


notifications:
  email:
    on_success: never
    on_failure: always
